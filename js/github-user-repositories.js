!function(e,r){if("function"==typeof define&&define.amd)define(["exports"],r);else if("undefined"!=typeof exports)r(exports);else{var t={exports:{}};r(t.exports),e.githubUserRepositories=t.exports}}(this,function(e){!function(r,t){if("function"==typeof define&&define.amd)define([],t);else if("undefined"!=typeof e)t();else{var n={exports:{}};t(),r.githubUserRepositories=n.exports}}(this,function(){"use strict";angular.module("github-user-repositories",[]).directive("linkListing",function(){return{scope:{linkList:"=links"},restrict:"E",replace:!0,templateUrl:"./template/link-listing.html"}}).factory("githubUserRepositoriesFactory",["$injector",function(e){var r=e.get("$log"),t=e.get("$http"),n=function(){var e=!(arguments.length<=0||void 0===arguments[0])&&arguments[0];if(!e)return!1;var r=e.headers("Link");return!!r&&(!!(r=r.split('; rel="next", <https://api.github.com/user/'))&&(r=r[1],!!r&&parseInt(r.replace(/(\w*)\/repos\?page=(\d*).*/g,"$2"),10)))},s={getAll:function(e,r){var t=n(r)||0,o=[],i=r.config.params;if(!t)return o;for(var u=i.page+1;u<=t;u++){var a=s.get(e,{per_page:i.per_page,page:u});o.push(a)}return o},get:function(e){var n=arguments.length<=1||void 0===arguments[1]?{page:1,per_page:50}:arguments[1];return new Promise(function(s,o){return r.debug("get","Username : "+e,"Page : "+n.page,"Per Page : "+n.per_page,n),t({method:"GET",url:"https://api.github.com/users/"+e+"/repos",params:n}).then(function(e){return e.status?200!==e.status?o(e):s(e):o(e)},function(e){return o(e)})})}};return s}]).controller("GithubUserRepositoriesController",["$scope","$injector",function(e,r){var t=this,n=r.get("$log"),s=r.get("githubUserRepositoriesFactory"),o=function(){return!!angular.isString(t.userName)&&t.userName.length>=1},i=function(){n.debug("resetting repositories"),t.repositories=[],t.error=""},u=function(e){return angular.isObject(e)===!1?(t.error=t.str.noResponse,n.error("checkResponse",t.str.noResponse,e),!1):200===e.status?(0===e.data.length&&(t.error=t.str.noRepos,n.debug("checkResponse",t.str.noRepos,e)),n.debug("checkResponse",200,e),!0):404===e.status?(t.error=t.str.noUser,n.debug("checkResponse",t.str.noUser,e),!1):(n.debug("checkResponse",t.str.noResponse,e),t.error=t.str.noResponse,!1)},a=function(e){return e.map(function(e){return{id:e.id,name:e.name,link:e.html_url}})},p=function(r){return n.debug("updateRepositories"+r.config.params.page,r),t.repositories=t.repositories.concat(a(r.data)),e.$digest(),t.repositories},c=function(e,r){return e!==r&&t.getRepositories().then(function(e){return n.debug("onUserNameChange.getRepositories",e)})["catch"](function(e){return n.error("onUserNameChange.failedToGetRepositories",e)})};Object.assign(t,{str:{title:"Github User Repositories",userName:"Username",usernamePlaceholder:"Please write a Github username to search",invalidUserName:"Username is not valid",noUser:"The Github user does not exist",noRepos:"Github user has no repos",noResponse:"Github API does not respond"},error:!1,userName:"",repositories:[],stripUserName:function(e){return!!angular.isObject(e.target)&&(!!angular.isString(e.target.value)&&void(e.target.value.indexOf(" ")>=0&&(t.userName=e.target.value.replace(/\s+/g,""))))},userNameModelOptions:{debounce:{"default":250,blur:0}},getRepositories:function(){return new Promise(function(r,a){return i(),o(t.userName)===!1?r(t.repositories):void s.get(t.userName).then(function(e){if(u(e)===!1)return a(e);if(p(e)===!1)return a(e);var o=s.getAll(t.userName,e);if(!o.length)return r(t.repositories);var i=o.map(function(r){r.then(function(e){n.debug("subPage"+e.config.params.page,e),u(e)&&p(e)})["catch"](function(r){n.error("subPage",r),u(e)})});return Promise.all(i)})["catch"](function(r){u(r),e.$digest(),a(r)}).then(function(){r(t.repositories)})["catch"](a)})}}),e.$watch(function(){return t.userName},c)}])})});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdpdGh1Yi11c2VyLXJlcG9zaXRvcmllcy5qcyJdLCJuYW1lcyI6WyJnbG9iYWwiLCJmYWN0b3J5IiwiZGVmaW5lIiwiYW1kIiwiZXhwb3J0cyIsIm1vZCIsImdpdGh1YlVzZXJSZXBvc2l0b3JpZXMiLCJ0aGlzIiwiYW5ndWxhciIsIm1vZHVsZSIsImRpcmVjdGl2ZSIsInNjb3BlIiwibGlua0xpc3QiLCJyZXN0cmljdCIsInJlcGxhY2UiLCJ0ZW1wbGF0ZVVybCIsIiRpbmplY3RvciIsIiRsb2ciLCJnZXQiLCIkaHR0cCIsImNoZWNrTGFzdFBhZ2UiLCJyZXNwb25zZSIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsImxpbmtzIiwiaGVhZGVycyIsInNwbGl0IiwicGFyc2VJbnQiLCJnZXRBbGwiLCJ1c2VyTmFtZSIsImxhc3RQYWdlIiwicmVxdWVzdHMiLCJwYXJhbXMiLCJjb25maWciLCJwYWdlIiwicmVxdWVzdCIsInBlcl9wYWdlIiwicHVzaCIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZGVidWciLCJtZXRob2QiLCJ1cmwiLCJ0aGVuIiwic3RhdHVzIiwiZXJyb3IiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwidm0iLCJpc1VzZXJuYW1lVmFsaWQiLCJpc1N0cmluZyIsInJlc2V0UmVwb3NpdG9yaWVzIiwicmVwb3NpdG9yaWVzIiwiY2hlY2tSZXNwb25zZSIsImlzT2JqZWN0Iiwic3RyIiwibm9SZXNwb25zZSIsImRhdGEiLCJub1JlcG9zIiwibm9Vc2VyIiwiZm9ybWF0UmVwb3NpdG9yaWVzIiwibWFwIiwicmVwb3NpdG9yeSIsImlkIiwibmFtZSIsImxpbmsiLCJodG1sX3VybCIsInVwZGF0ZVJlcG9zaXRvcmllcyIsImNvbmNhdCIsIiRkaWdlc3QiLCJvblVzZXJOYW1lQ2hhbmdlIiwibmV3VmFsIiwib2xkVmFsIiwiZ2V0UmVwb3NpdG9yaWVzIiwiT2JqZWN0IiwiYXNzaWduIiwidGl0bGUiLCJ1c2VybmFtZVBsYWNlaG9sZGVyIiwiaW52YWxpZFVzZXJOYW1lIiwic3RyaXBVc2VyTmFtZSIsImV2ZW50IiwidGFyZ2V0IiwidmFsdWUiLCJpbmRleE9mIiwidXNlck5hbWVNb2RlbE9wdGlvbnMiLCJkZWJvdW5jZSIsImRlZmF1bHQiLCJibHVyIiwic3ViUGFnZXMiLCJzdWJSZXF1ZXN0cyIsImFsbCIsIiR3YXRjaCJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBV0EsRUFBUUMsR0FDakIsR0FBc0Isa0JBQVhDLFNBQXlCQSxPQUFPQyxJQUN6Q0QsUUFBUSxXQUFZRCxPQUNmLElBQXVCLG1CQUFaRyxTQUNoQkgsRUFBUUcsYUFDSCxDQUNMLEdBQUlDLElBQ0ZELFdBRUZILEdBQVFJLEVBQUlELFNBQ1pKLEVBQU9NLHVCQUF5QkQsRUFBSUQsVUFFckNHLEtBQU0sU0FBVUgsSUFDakIsU0FBV0osRUFBUUMsR0FDakIsR0FBc0Isa0JBQVhDLFNBQXlCQSxPQUFPQyxJQUN6Q0QsVUFBV0QsT0FDTixJQUF1QixtQkFBWkcsR0FDaEJILFFBQ0ssQ0FDTCxHQUFJSSxJQUNGRCxXQUVGSCxLQUNBRCxFQUFPTSx1QkFBeUJELEVBQUlELFVBRXJDRyxLQUFNLFdBQ1AsWUExQkpDLFNBQVFDLE9BQU8sK0JBQ1pDLFVBQVUsY0FBZSxXQUN4QixPQUNFQyxPQUNFQyxTQUFhLFVBRWZDLFNBQVUsSUFDVkMsU0FBVSxFQUNWQyxZQUFhLGtDQUdoQmQsUUFBUSxpQ0FBQSxZQUFpQyxTQUFDZSxHQUV6QyxHQUVFQyxHQUFPRCxFQUFVRSxJQUFJLFFBRXJCQyxFQUFRSCxFQUFVRSxJQUFJLFNBRXRCRSxFQUFnQixXQUFzQixHQUFyQkMsS0FBcUJDLFVBQUFDLFFBQUEsR0FBQUMsU0FBQUYsVUFBQSxLQUFBQSxVQUFBLEVBRXBDLEtBQUtELEVBQ0gsT0FBTyxDQUdULElBQUlJLEdBQVFKLEVBQVNLLFFBQVEsT0FFN0IsU0FBS0QsT0FJTEEsRUFBUUEsRUFBTUUsTUFBTSxrREFNcEJGLEVBQVFBLEVBQU0sS0FFVEEsR0FJRUcsU0FBU0gsRUFBTVgsUUFBUSw4QkFBK0IsTUFBTyxPQUlsRWIsR0FFSjRCLE9BQVMsU0FBQ0MsRUFBVVQsR0FFbEIsR0FDRVUsR0FBV1gsRUFBY0MsSUFBYSxFQUN0Q1csS0FDQUMsRUFBU1osRUFBU2EsT0FBT0QsTUFFM0IsS0FBS0YsRUFDSCxNQUFPQyxFQUdULEtBQUksR0FBSUcsR0FBT0YsRUFBT0UsS0FBTyxFQUFHQSxHQUFRSixFQUFVSSxJQUFRLENBQ3hELEdBQUlDLEdBQVVuQyxFQUFRaUIsSUFBSVksR0FDeEJPLFNBQVdKLEVBQU9JLFNBQ2xCRixLQUFBQSxHQUVGSCxHQUFTTSxLQUFLRixHQUdoQixNQUFPSixJQUlUZCxJQUFNLFNBQUNZLEdBQUQsR0FBV0csR0FBWFgsVUFBQUMsUUFBQSxHQUFBQyxTQUFBRixVQUFBLElBQ0phLEtBQU8sRUFDUEUsU0FBVyxJQUZQZixVQUFBLEVBQUEsT0FHQyxJQUFJaUIsU0FBUSxTQUFDQyxFQUFTQyxHQVUzQixNQVJBeEIsR0FBS3lCLE1BQ0gsTUFERixjQUVnQlosRUFGaEIsVUFHWUcsRUFBT0UsS0FIbkIsY0FJZ0JGLEVBQU9JLFNBQ3JCSixHQUdLZCxHQUNMd0IsT0FBUyxNQUNUQyxJQUFBLGdDQUFzQ2QsRUFBdEMsU0FDQUcsT0FBQUEsSUFDQ1ksS0FBSyxTQUFDeEIsR0FFUCxNQUFLQSxHQUFTeUIsT0FJVSxNQUFwQnpCLEVBQVN5QixPQUNKTCxFQUFPcEIsR0FHVG1CLEVBQVFuQixHQVBOb0IsRUFBT3BCLElBU2YsU0FBQzBCLEdBQUQsTUFBV04sR0FBT00sUUFNekIsT0FBTzlDLE1BR1IrQyxXQUFXLG9DQUFBLFNBQUEsWUFBb0MsU0FBVUMsRUFBUWpDLEdBRWhFLEdBRUVrQyxHQUFLM0MsS0FFTFUsRUFBT0QsRUFBVUUsSUFBSSxRQUVyQlosRUFBeUJVLEVBQVVFLElBQUksaUNBRXZDaUMsRUFBa0IsV0FFaEIsUUFBSzNDLFFBQVE0QyxTQUFTRixFQUFHcEIsV0FJbEJvQixFQUFHcEIsU0FBU1AsUUFBVSxHQUcvQjhCLEVBQW9CLFdBQ2xCcEMsRUFBS3lCLE1BQU0sMEJBQ1hRLEVBQUdJLGdCQUNISixFQUFHSCxNQUFRLElBR2JRLEVBQWdCLFNBQUNsQyxHQUVmLE1BQUliLFNBQVFnRCxTQUFTbkMsTUFBYyxHQUNqQzZCLEVBQUdILE1BQVFHLEVBQUdPLElBQUlDLFdBQ2xCekMsRUFBSzhCLE1BQU0sZ0JBQWlCRyxFQUFHTyxJQUFJQyxXQUFZckMsSUFDeEMsR0FHZSxNQUFwQkEsRUFBU3lCLFFBRWtCLElBQXpCekIsRUFBU3NDLEtBQUtwQyxTQUNoQjJCLEVBQUdILE1BQVFHLEVBQUdPLElBQUlHLFFBQ2xCM0MsRUFBS3lCLE1BQU0sZ0JBQWlCUSxFQUFHTyxJQUFJRyxRQUFTdkMsSUFHOUNKLEVBQUt5QixNQUFNLGdCQUFpQixJQUFLckIsSUFDMUIsR0FHZSxNQUFwQkEsRUFBU3lCLFFBQ1hJLEVBQUdILE1BQVFHLEVBQUdPLElBQUlJLE9BQ2xCNUMsRUFBS3lCLE1BQU0sZ0JBQWlCUSxFQUFHTyxJQUFJSSxPQUFReEMsSUFDcEMsSUFHVEosRUFBS3lCLE1BQU0sZ0JBQWlCUSxFQUFHTyxJQUFJQyxXQUFZckMsR0FDL0M2QixFQUFHSCxNQUFRRyxFQUFHTyxJQUFJQyxZQUNYLElBSVRJLEVBQXFCLFNBQUNSLEdBQUQsTUFBa0JBLEdBQ3BDUyxJQUFJLFNBQUNDLEdBQUQsT0FDSEMsR0FBS0QsRUFBV0MsR0FDaEJDLEtBQU9GLEVBQVdFLEtBQ2xCQyxLQUFPSCxFQUFXSSxhQUd0QkMsRUFBcUIsU0FBQ2hELEdBUXBCLE1BUEFKLEdBQUt5QixNQUFMLHFCQUFnQ3JCLEVBQVNhLE9BQU9ELE9BQU9FLEtBQVFkLEdBRS9ENkIsRUFBR0ksYUFBZUosRUFBR0ksYUFDbEJnQixPQUFPUixFQUFtQnpDLEVBQVNzQyxPQUV0Q1YsRUFBT3NCLFVBRUFyQixFQUFHSSxjQUdaa0IsRUFBbUIsU0FBQ0MsRUFBUUMsR0FDMUIsTUFBSUQsS0FBV0MsR0FJUnhCLEVBQ0p5QixrQkFDQTlCLEtBQUssU0FBQ1MsR0FBRCxNQUFrQnJDLEdBQ3JCeUIsTUFBTSxtQ0FBb0NZLEtBSHhDSixTQUlFLFNBQUNJLEdBQUQsTUFBa0JyQyxHQUN0QjhCLE1BQU0sMkNBQTRDTyxLQUczRHNCLFFBQU9DLE9BQU8zQixHQUVaTyxLQUNFcUIsTUFBUSwyQkFDUmhELFNBQVcsV0FDWGlELG9CQUFzQiwyQ0FDdEJDLGdCQUFrQix3QkFDbEJuQixPQUFTLGlDQUNURCxRQUFVLDJCQUNWRixXQUFhLCtCQUdmWCxPQUFRLEVBRVJqQixTQUFXLEdBRVh3QixnQkFFQTJCLGNBQWdCLFNBQVVDLEdBRXhCLFFBQUsxRSxRQUFRZ0QsU0FBUzBCLEVBQU1DLFlBSXZCM0UsUUFBUTRDLFNBQVM4QixFQUFNQyxPQUFPQyxhQUkvQkYsRUFBTUMsT0FBT0MsTUFBTUMsUUFBUSxNQUFRLElBQ3JDbkMsRUFBR3BCLFNBQVdvRCxFQUFNQyxPQUFPQyxNQUFNdEUsUUFBUSxPQUFRLFFBSXJEd0Usc0JBQ0VDLFVBQ0VDLFVBQVUsSUFDVkMsS0FBTyxJQUlYZCxnQkFBa0IsV0FBQSxNQUFNLElBQUlwQyxTQUFRLFNBQUNDLEVBQVNDLEdBSTVDLE1BRkFZLEtBRUlGLEVBQWdCRCxFQUFHcEIsYUFBYyxFQUM1QlUsRUFBUVUsRUFBR0ksa0JBR3BCaEQsR0FDR1ksSUFBSWdDLEVBQUdwQixVQUNQZSxLQUFLLFNBQUN4QixHQUVMLEdBQUlrQyxFQUFjbEMsTUFBYyxFQUM5QixNQUFPb0IsR0FBT3BCLEVBR2hCLElBQUlnRCxFQUFtQmhELE1BQWMsRUFDbkMsTUFBT29CLEdBQU9wQixFQUdoQixJQUFJcUUsR0FBV3BGLEVBQ1p1QixPQUFPcUIsRUFBR3BCLFNBQVVULEVBRXZCLEtBQUtxRSxFQUFTbkUsT0FDWixNQUFPaUIsR0FBUVUsRUFBR0ksYUFHcEIsSUFBSXFDLEdBQWNELEVBQVMzQixJQUFJLFNBQUMzQixHQUM5QkEsRUFDR1MsS0FBSyxTQUFDeEIsR0FDTEosRUFBS3lCLE1BQUwsVUFBcUJyQixFQUFTYSxPQUFPRCxPQUFPRSxLQUFRZCxHQUNoRGtDLEVBQWNsQyxJQUNoQmdELEVBQW1CaEQsS0FKekJlLFNBT1MsU0FBQ1csR0FDTjlCLEVBQUs4QixNQUFNLFVBQVdBLEdBQ3RCUSxFQUFjbEMsTUFJcEIsT0FBT2tCLFNBQVFxRCxJQUFJRCxLQWpDdkJyRixTQXFDUyxTQUFDZSxHQUVOa0MsRUFBY2xDLEdBQ2Q0QixFQUFPc0IsVUFFUDlCLEVBQU9wQixLQUdSd0IsS0FBSyxXQUVKTCxFQUFRVSxFQUFHSSxnQkEvQ2ZoRCxTQWtEU21DLFFBT2JRLEVBQU80QyxPQUFPLFdBQUEsTUFBTTNDLEdBQUdwQixVQUFVMEMiLCJmaWxlIjoiZ2l0aHViLXVzZXItcmVwb3NpdG9yaWVzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiYW5ndWxhci5tb2R1bGUoJ2dpdGh1Yi11c2VyLXJlcG9zaXRvcmllcycsIFtdKVxuICAuZGlyZWN0aXZlKCdsaW5rTGlzdGluZycsICgpID0+IHtcbiAgICByZXR1cm4ge1xuICAgICAgc2NvcGUgOiB7XG4gICAgICAgICdsaW5rTGlzdCcgOiAnPWxpbmtzJ1xuICAgICAgfSxcbiAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICByZXBsYWNlIDogdHJ1ZSxcbiAgICAgIHRlbXBsYXRlVXJsOiAnLi90ZW1wbGF0ZS9saW5rLWxpc3RpbmcuaHRtbCdcbiAgICB9O1xuICB9KVxuICAuZmFjdG9yeSgnZ2l0aHViVXNlclJlcG9zaXRvcmllc0ZhY3RvcnknLCAoJGluamVjdG9yKSA9PiB7XG5cbiAgICBjb25zdFxuXG4gICAgICAkbG9nID0gJGluamVjdG9yLmdldCgnJGxvZycpLFxuXG4gICAgICAkaHR0cCA9ICRpbmplY3Rvci5nZXQoJyRodHRwJyksXG5cbiAgICAgIGNoZWNrTGFzdFBhZ2UgPSAocmVzcG9uc2UgPSBmYWxzZSkgPT4ge1xuXG4gICAgICAgIGlmICghcmVzcG9uc2UpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgbGlua3MgPSByZXNwb25zZS5oZWFkZXJzKCdMaW5rJyk7XG5cbiAgICAgICAgaWYgKCFsaW5rcykge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxpbmtzID0gbGlua3Muc3BsaXQoJzsgcmVsPVwibmV4dFwiLCA8aHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS91c2VyLycpO1xuXG4gICAgICAgIGlmICghbGlua3MpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBsaW5rcyA9IGxpbmtzWzFdO1xuXG4gICAgICAgIGlmICghbGlua3MpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcGFyc2VJbnQobGlua3MucmVwbGFjZSgvKFxcdyopXFwvcmVwb3NcXD9wYWdlPShcXGQqKS4qL2csICckMicpLCAxMCk7XG5cbiAgICAgIH07XG5cbiAgICBjb25zdCBmYWN0b3J5ID0ge1xuXG4gICAgICBnZXRBbGwgOiAodXNlck5hbWUsIHJlc3BvbnNlKSA9PiB7XG5cbiAgICAgICAgdmFyXG4gICAgICAgICAgbGFzdFBhZ2UgPSBjaGVja0xhc3RQYWdlKHJlc3BvbnNlKSB8fCAwLFxuICAgICAgICAgIHJlcXVlc3RzID0gW10sXG4gICAgICAgICAgcGFyYW1zID0gcmVzcG9uc2UuY29uZmlnLnBhcmFtcztcblxuICAgICAgICBpZiAoIWxhc3RQYWdlKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcXVlc3RzO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yKHZhciBwYWdlID0gcGFyYW1zLnBhZ2UgKyAxOyBwYWdlIDw9IGxhc3RQYWdlOyBwYWdlKyspIHtcbiAgICAgICAgICB2YXIgcmVxdWVzdCA9IGZhY3RvcnkuZ2V0KHVzZXJOYW1lLCB7XG4gICAgICAgICAgICBwZXJfcGFnZSA6IHBhcmFtcy5wZXJfcGFnZSxcbiAgICAgICAgICAgIHBhZ2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXF1ZXN0cy5wdXNoKHJlcXVlc3QpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlcXVlc3RzO1xuXG4gICAgICB9LFxuXG4gICAgICBnZXQgOiAodXNlck5hbWUsIHBhcmFtcyA9IHtcbiAgICAgICAgcGFnZSA6IDEsXG4gICAgICAgIHBlcl9wYWdlIDogNTBcbiAgICAgIH0pID0+IChuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG5cbiAgICAgICAgJGxvZy5kZWJ1ZyhcbiAgICAgICAgICAnZ2V0JyxcbiAgICAgICAgICBgVXNlcm5hbWUgOiAke3VzZXJOYW1lfWAsXG4gICAgICAgICAgYFBhZ2UgOiAke3BhcmFtcy5wYWdlfWAsXG4gICAgICAgICAgYFBlciBQYWdlIDogJHtwYXJhbXMucGVyX3BhZ2V9YCxcbiAgICAgICAgICBwYXJhbXNcbiAgICAgICAgKTtcblxuICAgICAgICByZXR1cm4gJGh0dHAoe1xuICAgICAgICAgIG1ldGhvZCA6ICdHRVQnLFxuICAgICAgICAgIHVybCA6IGBodHRwczovL2FwaS5naXRodWIuY29tL3VzZXJzLyR7dXNlck5hbWV9L3JlcG9zYCxcbiAgICAgICAgICBwYXJhbXNcbiAgICAgICAgfSkudGhlbigocmVzcG9uc2UpID0+IHtcblxuICAgICAgICAgIGlmICghcmVzcG9uc2Uuc3RhdHVzKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVqZWN0KHJlc3BvbnNlKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgIHJldHVybiByZWplY3QocmVzcG9uc2UpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiByZXNvbHZlKHJlc3BvbnNlKTtcblxuICAgICAgICB9LCAoZXJyb3IpID0+IHJlamVjdChlcnJvcikpXG5cbiAgICAgIH0pKVxuXG4gICAgfTtcblxuICAgIHJldHVybiBmYWN0b3J5O1xuXG4gIH0pXG4gIC5jb250cm9sbGVyKCdHaXRodWJVc2VyUmVwb3NpdG9yaWVzQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkc2NvcGUsICRpbmplY3Rvcikge1xuXG4gICAgY29uc3RcblxuICAgICAgdm0gPSB0aGlzLFxuXG4gICAgICAkbG9nID0gJGluamVjdG9yLmdldCgnJGxvZycpLFxuXG4gICAgICBnaXRodWJVc2VyUmVwb3NpdG9yaWVzID0gJGluamVjdG9yLmdldCgnZ2l0aHViVXNlclJlcG9zaXRvcmllc0ZhY3RvcnknKSxcblxuICAgICAgaXNVc2VybmFtZVZhbGlkID0gKCkgPT4ge1xuXG4gICAgICAgIGlmICghYW5ndWxhci5pc1N0cmluZyh2bS51c2VyTmFtZSkpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdm0udXNlck5hbWUubGVuZ3RoID49IDE7XG4gICAgICB9LFxuXG4gICAgICByZXNldFJlcG9zaXRvcmllcyA9ICgpID0+IHtcbiAgICAgICAgJGxvZy5kZWJ1ZygncmVzZXR0aW5nIHJlcG9zaXRvcmllcycpO1xuICAgICAgICB2bS5yZXBvc2l0b3JpZXMgPSBbXTtcbiAgICAgICAgdm0uZXJyb3IgPSAnJztcbiAgICAgIH0sXG5cbiAgICAgIGNoZWNrUmVzcG9uc2UgPSAocmVzcG9uc2UpID0+IHtcblxuICAgICAgICBpZiAoYW5ndWxhci5pc09iamVjdChyZXNwb25zZSkgPT09IGZhbHNlKSB7XG4gICAgICAgICAgdm0uZXJyb3IgPSB2bS5zdHIubm9SZXNwb25zZTtcbiAgICAgICAgICAkbG9nLmVycm9yKCdjaGVja1Jlc3BvbnNlJywgdm0uc3RyLm5vUmVzcG9uc2UsIHJlc3BvbnNlKTtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcblxuICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgdm0uZXJyb3IgPSB2bS5zdHIubm9SZXBvcztcbiAgICAgICAgICAgICRsb2cuZGVidWcoJ2NoZWNrUmVzcG9uc2UnLCB2bS5zdHIubm9SZXBvcywgcmVzcG9uc2UpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgICRsb2cuZGVidWcoJ2NoZWNrUmVzcG9uc2UnLCAyMDAsIHJlc3BvbnNlKTtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwNCkge1xuICAgICAgICAgIHZtLmVycm9yID0gdm0uc3RyLm5vVXNlcjtcbiAgICAgICAgICAkbG9nLmRlYnVnKCdjaGVja1Jlc3BvbnNlJywgdm0uc3RyLm5vVXNlciwgcmVzcG9uc2UpO1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgICRsb2cuZGVidWcoJ2NoZWNrUmVzcG9uc2UnLCB2bS5zdHIubm9SZXNwb25zZSwgcmVzcG9uc2UpO1xuICAgICAgICB2bS5lcnJvciA9IHZtLnN0ci5ub1Jlc3BvbnNlO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG5cbiAgICAgIH0sXG5cbiAgICAgIGZvcm1hdFJlcG9zaXRvcmllcyA9IChyZXBvc2l0b3JpZXMpID0+IHJlcG9zaXRvcmllc1xuICAgICAgICAubWFwKChyZXBvc2l0b3J5KSA9PiAoe1xuICAgICAgICAgIGlkIDogcmVwb3NpdG9yeS5pZCxcbiAgICAgICAgICBuYW1lIDogcmVwb3NpdG9yeS5uYW1lLFxuICAgICAgICAgIGxpbmsgOiByZXBvc2l0b3J5Lmh0bWxfdXJsXG4gICAgICAgIH0pKSxcblxuICAgICAgdXBkYXRlUmVwb3NpdG9yaWVzID0gKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICRsb2cuZGVidWcoYHVwZGF0ZVJlcG9zaXRvcmllcyR7cmVzcG9uc2UuY29uZmlnLnBhcmFtcy5wYWdlfWAsIHJlc3BvbnNlKTtcblxuICAgICAgICB2bS5yZXBvc2l0b3JpZXMgPSB2bS5yZXBvc2l0b3JpZXNcbiAgICAgICAgICAuY29uY2F0KGZvcm1hdFJlcG9zaXRvcmllcyhyZXNwb25zZS5kYXRhKSk7XG5cbiAgICAgICAgJHNjb3BlLiRkaWdlc3QoKTtcblxuICAgICAgICByZXR1cm4gdm0ucmVwb3NpdG9yaWVzO1xuICAgICAgfSxcblxuICAgICAgb25Vc2VyTmFtZUNoYW5nZSA9IChuZXdWYWwsIG9sZFZhbCkgPT4ge1xuICAgICAgICBpZiAobmV3VmFsID09PSBvbGRWYWwpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdm1cbiAgICAgICAgICAuZ2V0UmVwb3NpdG9yaWVzKClcbiAgICAgICAgICAudGhlbigocmVwb3NpdG9yaWVzKSA9PiAkbG9nXG4gICAgICAgICAgICAuZGVidWcoJ29uVXNlck5hbWVDaGFuZ2UuZ2V0UmVwb3NpdG9yaWVzJywgcmVwb3NpdG9yaWVzKSlcbiAgICAgICAgICAuY2F0Y2goKHJlcG9zaXRvcmllcykgPT4gJGxvZ1xuICAgICAgICAgICAgLmVycm9yKCdvblVzZXJOYW1lQ2hhbmdlLmZhaWxlZFRvR2V0UmVwb3NpdG9yaWVzJywgcmVwb3NpdG9yaWVzKSk7XG4gICAgICB9O1xuXG4gICAgT2JqZWN0LmFzc2lnbih2bSwge1xuXG4gICAgICBzdHIgOiB7XG4gICAgICAgIHRpdGxlIDogJ0dpdGh1YiBVc2VyIFJlcG9zaXRvcmllcycsXG4gICAgICAgIHVzZXJOYW1lIDogJ1VzZXJuYW1lJyxcbiAgICAgICAgdXNlcm5hbWVQbGFjZWhvbGRlciA6ICdQbGVhc2Ugd3JpdGUgYSBHaXRodWIgdXNlcm5hbWUgdG8gc2VhcmNoJyxcbiAgICAgICAgaW52YWxpZFVzZXJOYW1lIDogJ1VzZXJuYW1lIGlzIG5vdCB2YWxpZCcsXG4gICAgICAgIG5vVXNlciA6ICdUaGUgR2l0aHViIHVzZXIgZG9lcyBub3QgZXhpc3QnLFxuICAgICAgICBub1JlcG9zIDogJ0dpdGh1YiB1c2VyIGhhcyBubyByZXBvcycsXG4gICAgICAgIG5vUmVzcG9uc2UgOiAnR2l0aHViIEFQSSBkb2VzIG5vdCByZXNwb25kJ1xuICAgICAgfSxcblxuICAgICAgZXJyb3IgOiBmYWxzZSxcblxuICAgICAgdXNlck5hbWUgOiAnJyxcblxuICAgICAgcmVwb3NpdG9yaWVzIDogW10sXG5cbiAgICAgIHN0cmlwVXNlck5hbWUgOiBmdW5jdGlvbiAoZXZlbnQpIHtcblxuICAgICAgICBpZiAoIWFuZ3VsYXIuaXNPYmplY3QoZXZlbnQudGFyZ2V0KSkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghYW5ndWxhci5pc1N0cmluZyhldmVudC50YXJnZXQudmFsdWUpKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGV2ZW50LnRhcmdldC52YWx1ZS5pbmRleE9mKCcgJykgPj0gMCkge1xuICAgICAgICAgIHZtLnVzZXJOYW1lID0gZXZlbnQudGFyZ2V0LnZhbHVlLnJlcGxhY2UoL1xccysvZywgJycpO1xuICAgICAgICB9XG4gICAgICB9LFxuXG4gICAgICB1c2VyTmFtZU1vZGVsT3B0aW9ucyA6IHtcbiAgICAgICAgZGVib3VuY2U6IHtcbiAgICAgICAgICBkZWZhdWx0IDogMjUwLFxuICAgICAgICAgIGJsdXIgOiAwXG4gICAgICAgIH1cbiAgICAgIH0sXG5cbiAgICAgIGdldFJlcG9zaXRvcmllcyA6ICgpID0+IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcblxuICAgICAgICByZXNldFJlcG9zaXRvcmllcygpO1xuXG4gICAgICAgIGlmIChpc1VzZXJuYW1lVmFsaWQodm0udXNlck5hbWUpID09PSBmYWxzZSkge1xuICAgICAgICAgIHJldHVybiByZXNvbHZlKHZtLnJlcG9zaXRvcmllcyk7XG4gICAgICAgIH1cblxuICAgICAgICBnaXRodWJVc2VyUmVwb3NpdG9yaWVzXG4gICAgICAgICAgLmdldCh2bS51c2VyTmFtZSlcbiAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHtcblxuICAgICAgICAgICAgaWYgKGNoZWNrUmVzcG9uc2UocmVzcG9uc2UpID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICByZXR1cm4gcmVqZWN0KHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHVwZGF0ZVJlcG9zaXRvcmllcyhyZXNwb25zZSkgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgIHJldHVybiByZWplY3QocmVzcG9uc2UpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgc3ViUGFnZXMgPSBnaXRodWJVc2VyUmVwb3NpdG9yaWVzXG4gICAgICAgICAgICAgIC5nZXRBbGwodm0udXNlck5hbWUsIHJlc3BvbnNlKTtcblxuICAgICAgICAgICAgaWYgKCFzdWJQYWdlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUodm0ucmVwb3NpdG9yaWVzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGV0IHN1YlJlcXVlc3RzID0gc3ViUGFnZXMubWFwKChyZXF1ZXN0KSA9PiB7XG4gICAgICAgICAgICAgIHJlcXVlc3RcbiAgICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICAgICAgICRsb2cuZGVidWcoYHN1YlBhZ2Uke3Jlc3BvbnNlLmNvbmZpZy5wYXJhbXMucGFnZX1gLCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICBpZiAoY2hlY2tSZXNwb25zZShyZXNwb25zZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlUmVwb3NpdG9yaWVzKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICAgICRsb2cuZXJyb3IoJ3N1YlBhZ2UnLCBlcnJvcik7XG4gICAgICAgICAgICAgICAgICBjaGVja1Jlc3BvbnNlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwoc3ViUmVxdWVzdHMpO1xuXG5cbiAgICAgICAgICB9KVxuICAgICAgICAgIC5jYXRjaCgocmVzcG9uc2UpID0+IHtcblxuICAgICAgICAgICAgY2hlY2tSZXNwb25zZShyZXNwb25zZSk7XG4gICAgICAgICAgICAkc2NvcGUuJGRpZ2VzdCgpO1xuXG4gICAgICAgICAgICByZWplY3QocmVzcG9uc2UpO1xuXG4gICAgICAgICAgfSlcbiAgICAgICAgICAudGhlbigoKSA9PiB7XG5cbiAgICAgICAgICAgIHJlc29sdmUodm0ucmVwb3NpdG9yaWVzKTtcblxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmNhdGNoKHJlamVjdClcblxuXG4gICAgICB9KVxuXG4gICAgfSk7XG5cbiAgICAkc2NvcGUuJHdhdGNoKCgpID0+IHZtLnVzZXJOYW1lLCBvblVzZXJOYW1lQ2hhbmdlKTtcblxuICB9KTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
