!function(e,r){if("function"==typeof define&&define.amd)define(["exports"],r);else if("undefined"!=typeof exports)r(exports);else{var t={exports:{}};r(t.exports),e.githubUserRepositories=t.exports}}(this,function(e){!function(r,t){if("function"==typeof define&&define.amd)define([],t);else if("undefined"!=typeof e)t();else{var n={exports:{}};t(),r.githubUserRepositories=n.exports}}(this,function(){"use strict";angular.module("github-user-repositories",[]).directive("linkListing",function(){return{scope:{linkList:"=links"},restrict:"E",replace:!0,templateUrl:"./template/link-listing.html"}}).factory("githubUserRepositoriesFactory",["$injector",function(e){var r=e.get("$log"),t=e.get("$http"),n=function(){var e=!(arguments.length<=0||void 0===arguments[0])&&arguments[0];if(!e)return!1;var r=e.headers("Link");return!!r&&(!!(r=r.split('; rel="next", <https://api.github.com/user/'))&&(r=r[1],!!r&&parseInt(r.replace(/(\w*)\/repos\?page=(\d*).*/g,"$2"),10)))},s={getAll:function(e,r){var t=n(r)||0,o=[],i=r.config.params;if(!t)return o;for(var u=i.page+1;u<=t;u++){var a=s.get(e,{per_page:i.per_page,page:u});o.push(a)}return o},get:function(e){var n=arguments.length<=1||void 0===arguments[1]?{page:1,per_page:50}:arguments[1];return new Promise(function(s,o){return r.debug("get","Username : "+e,"Page : "+n.page,"Per Page : "+n.per_page,n),t({method:"GET",url:"https://api.github.com/users/"+e+"/repos",params:n}).then(function(e){return e.status?200!==e.status?o(e):s(e):o(e)},function(e){return o(e)})})}};return s}]).controller("GithubUserRepositoriesController",["$scope","$injector",function(e,r){var t=this,n=r.get("$log"),s=r.get("githubUserRepositoriesFactory"),o=function(){return!!angular.isString(t.userName)&&t.userName.length>=1},i=function(){n.debug("resetting repositories"),t.repositories=[],t.error=""},u=function(e){return angular.isObject(e)===!1?(t.error=t.str.noResponse,n.error("checkResponse",t.str.noResponse,e),!1):200===e.status?(0===e.data.length&&(t.error=t.str.noRepos,n.debug("checkResponse",t.str.noRepos,e)),n.debug("checkResponse",200,e),!0):404===e.status?(t.error=t.str.noUser,n.debug("checkResponse",t.str.noUser,e),!1):(n.debug("checkResponse",t.str.noResponse,e),t.error=t.str.noResponse,!1)},a=function(e){return e.map(function(e){return{id:e.id,name:e.name,link:e.html_url}})},p=function(r){return n.debug("updateRepositories"+r.config.params.page,r),t.repositories=t.repositories.concat(a(r.data)),e.$digest(),t.repositories},c=function(e,r){return e!==r&&t.getRepositories().then(function(e){return n.debug("onUserNameChange.getRepositories",e)})["catch"](function(e){return n.error("onUserNameChange.failedToGetRepositories",e)})};Object.assign(t,{str:{title:"Github User Repositories",userName:"Username",usernamePlaceholder:"Please write a Github username to search",invalidUserName:"Username is not valid",noUser:"The Github user does not exist",noRepos:"Github user has no repos",noResponse:"Github API does not respond"},error:!1,userName:"",repositories:[],userNameModelOptions:{debounce:{"default":250,blur:0}},stripUserName:function(e){return!!angular.isObject(e.target)&&(!!angular.isString(e.target.value)&&void(e.target.value.indexOf(" ")>=0&&(t.userName=e.target.value.replace(/\s+/g,""))))},getRepositories:function(){return new Promise(function(r,a){return i(),o(t.userName)===!1?r(t.repositories):void s.get(t.userName).then(function(e){if(u(e)===!1)return a(e);if(p(e)===!1)return a(e);var o=s.getAll(t.userName,e);if(!o.length)return r(t.repositories);var i=o.map(function(r){r.then(function(e){n.debug("subPage"+e.config.params.page,e),u(e)&&p(e)})["catch"](function(r){n.error("subPage",r),u(e)})});return Promise.all(i)})["catch"](function(r){u(r),e.$digest(),a(r)}).then(function(){r(t.repositories)})["catch"](a)})}}),e.$watch(function(){return t.userName},c)}])})});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdpdGh1Yi11c2VyLXJlcG9zaXRvcmllcy5qcyJdLCJuYW1lcyI6WyJnbG9iYWwiLCJmYWN0b3J5IiwiZGVmaW5lIiwiYW1kIiwiZXhwb3J0cyIsIm1vZCIsImdpdGh1YlVzZXJSZXBvc2l0b3JpZXMiLCJ0aGlzIiwiYW5ndWxhciIsIm1vZHVsZSIsImRpcmVjdGl2ZSIsInNjb3BlIiwibGlua0xpc3QiLCJyZXN0cmljdCIsInJlcGxhY2UiLCJ0ZW1wbGF0ZVVybCIsIiRpbmplY3RvciIsIiRsb2ciLCJnZXQiLCIkaHR0cCIsImNoZWNrTGFzdFBhZ2UiLCJyZXNwb25zZSIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsImxpbmtzIiwiaGVhZGVycyIsInNwbGl0IiwicGFyc2VJbnQiLCJnZXRBbGwiLCJ1c2VyTmFtZSIsImxhc3RQYWdlIiwicmVxdWVzdHMiLCJwYXJhbXMiLCJjb25maWciLCJwYWdlIiwicmVxdWVzdCIsInBlcl9wYWdlIiwicHVzaCIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZGVidWciLCJtZXRob2QiLCJ1cmwiLCJ0aGVuIiwic3RhdHVzIiwiZXJyb3IiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwidm0iLCJpc1VzZXJuYW1lVmFsaWQiLCJpc1N0cmluZyIsInJlc2V0UmVwb3NpdG9yaWVzIiwicmVwb3NpdG9yaWVzIiwiY2hlY2tSZXNwb25zZSIsImlzT2JqZWN0Iiwic3RyIiwibm9SZXNwb25zZSIsImRhdGEiLCJub1JlcG9zIiwibm9Vc2VyIiwiZm9ybWF0UmVwb3NpdG9yaWVzIiwibWFwIiwicmVwb3NpdG9yeSIsImlkIiwibmFtZSIsImxpbmsiLCJodG1sX3VybCIsInVwZGF0ZVJlcG9zaXRvcmllcyIsImNvbmNhdCIsIiRkaWdlc3QiLCJvblVzZXJOYW1lQ2hhbmdlIiwibmV3VmFsIiwib2xkVmFsIiwiZ2V0UmVwb3NpdG9yaWVzIiwiT2JqZWN0IiwiYXNzaWduIiwidGl0bGUiLCJ1c2VybmFtZVBsYWNlaG9sZGVyIiwiaW52YWxpZFVzZXJOYW1lIiwidXNlck5hbWVNb2RlbE9wdGlvbnMiLCJkZWJvdW5jZSIsImRlZmF1bHQiLCJibHVyIiwic3RyaXBVc2VyTmFtZSIsImV2ZW50IiwidGFyZ2V0IiwidmFsdWUiLCJpbmRleE9mIiwic3ViUGFnZXMiLCJzdWJSZXF1ZXN0cyIsImFsbCIsIiR3YXRjaCJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBV0EsRUFBUUMsR0FDakIsR0FBc0Isa0JBQVhDLFNBQXlCQSxPQUFPQyxJQUN6Q0QsUUFBUSxXQUFZRCxPQUNmLElBQXVCLG1CQUFaRyxTQUNoQkgsRUFBUUcsYUFDSCxDQUNMLEdBQUlDLElBQ0ZELFdBRUZILEdBQVFJLEVBQUlELFNBQ1pKLEVBQU9NLHVCQUF5QkQsRUFBSUQsVUFFckNHLEtBQU0sU0FBVUgsSUFDakIsU0FBV0osRUFBUUMsR0FDakIsR0FBc0Isa0JBQVhDLFNBQXlCQSxPQUFPQyxJQUN6Q0QsVUFBV0QsT0FDTixJQUF1QixtQkFBWkcsR0FDaEJILFFBQ0ssQ0FDTCxHQUFJSSxJQUNGRCxXQUVGSCxLQUNBRCxFQUFPTSx1QkFBeUJELEVBQUlELFVBRXJDRyxLQUFNLFdBQ1AsWUExQkpDLFNBQVFDLE9BQU8sK0JBQ1pDLFVBQVUsY0FBZSxXQUN4QixPQUNFQyxPQUNFQyxTQUFhLFVBRWZDLFNBQVUsSUFDVkMsU0FBVSxFQUNWQyxZQUFhLGtDQUdoQmQsUUFBUSxpQ0FBQSxZQUFpQyxTQUFDZSxHQUV6QyxHQUVFQyxHQUFPRCxFQUFVRSxJQUFJLFFBRXJCQyxFQUFRSCxFQUFVRSxJQUFJLFNBR3RCRSxFQUFnQixXQUFzQixHQUFyQkMsS0FBcUJDLFVBQUFDLFFBQUEsR0FBQUMsU0FBQUYsVUFBQSxLQUFBQSxVQUFBLEVBRXBDLEtBQUtELEVBQ0gsT0FBTyxDQUdULElBQUlJLEdBQVFKLEVBQVNLLFFBQVEsT0FFN0IsU0FBS0QsT0FJTEEsRUFBUUEsRUFBTUUsTUFBTSxrREFNcEJGLEVBQVFBLEVBQU0sS0FFVEEsR0FJRUcsU0FBU0gsRUFBTVgsUUFB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TjlCLEVBQUs4QixNQUFNLFVBQVdBLEdBQ3RCUSxFQUFjbEMsTUFJcEIsT0FBT2tCLFNBQVFxRCxJQUFJRCxLQWpDdkJyRixTQW9DUyxTQUFDZSxHQUVOa0MsRUFBY2xDLEdBQ2Q0QixFQUFPc0IsVUFFUDlCLEVBQU9wQixLQUdSd0IsS0FBSyxXQUVKTCxFQUFRVSxFQUFHSSxnQkE5Q2ZoRCxTQWlEU21DLFFBTWJRLEVBQU80QyxPQUFPLFdBQUEsTUFBTTNDLEdBQUdwQixVQUFVMEMiLCJmaWxlIjoiZ2l0aHViLXVzZXItcmVwb3NpdG9yaWVzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiYW5ndWxhci5tb2R1bGUoJ2dpdGh1Yi11c2VyLXJlcG9zaXRvcmllcycsIFtdKVxuICAuZGlyZWN0aXZlKCdsaW5rTGlzdGluZycsICgpID0+IHtcbiAgICByZXR1cm4ge1xuICAgICAgc2NvcGUgOiB7XG4gICAgICAgICdsaW5rTGlzdCcgOiAnPWxpbmtzJ1xuICAgICAgfSxcbiAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICByZXBsYWNlIDogdHJ1ZSxcbiAgICAgIHRlbXBsYXRlVXJsOiAnLi90ZW1wbGF0ZS9saW5rLWxpc3RpbmcuaHRtbCdcbiAgICB9O1xuICB9KVxuICAuZmFjdG9yeSgnZ2l0aHViVXNlclJlcG9zaXRvcmllc0ZhY3RvcnknLCAoJGluamVjdG9yKSA9PiB7XG5cbiAgICBjb25zdFxuXG4gICAgICAkbG9nID0gJGluamVjdG9yLmdldCgnJGxvZycpLFxuXG4gICAgICAkaHR0cCA9ICRpbmplY3Rvci5nZXQoJyRodHRwJyksXG5cbiAgICAgIC8vIFJldHJpZXZlcyBsYXN0IHBhZ2UgbnVtYmVyXG4gICAgICBjaGVja0xhc3RQYWdlID0gKHJlc3BvbnNlID0gZmFsc2UpID0+IHtcblxuICAgICAgICBpZiAoIXJlc3BvbnNlKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGxpbmtzID0gcmVzcG9uc2UuaGVhZGVycygnTGluaycpO1xuXG4gICAgICAgIGlmICghbGlua3MpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBsaW5rcyA9IGxpbmtzLnNwbGl0KCc7IHJlbD1cIm5leHRcIiwgPGh0dHBzOi8vYXBpLmdpdGh1Yi5jb20vdXNlci8nKTtcblxuICAgICAgICBpZiAoIWxpbmtzKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgbGlua3MgPSBsaW5rc1sxXTtcblxuICAgICAgICBpZiAoIWxpbmtzKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHBhcnNlSW50KGxpbmtzLnJlcGxhY2UoLyhcXHcqKVxcL3JlcG9zXFw/cGFnZT0oXFxkKikuKi9nLCAnJDInKSwgMTApO1xuXG4gICAgICB9O1xuXG4gICAgY29uc3QgZmFjdG9yeSA9IHtcblxuICAgICAgLy8gU2VudHMgbXVsdGlwbGUgY29uY3VycmVudCByZXF1ZXN0cyBmb3Igc3VicGFnZXNcbiAgICAgIGdldEFsbCA6ICh1c2VyTmFtZSwgcmVzcG9uc2UpID0+IHtcblxuICAgICAgICB2YXJcbiAgICAgICAgICBsYXN0UGFnZSA9IGNoZWNrTGFzdFBhZ2UocmVzcG9uc2UpIHx8IDAsXG4gICAgICAgICAgcmVxdWVzdHMgPSBbXSxcbiAgICAgICAgICBwYXJhbXMgPSByZXNwb25zZS5jb25maWcucGFyYW1zO1xuXG4gICAgICAgIGlmICghbGFzdFBhZ2UpIHtcbiAgICAgICAgICByZXR1cm4gcmVxdWVzdHM7XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKHZhciBwYWdlID0gcGFyYW1zLnBhZ2UgKyAxOyBwYWdlIDw9IGxhc3RQYWdlOyBwYWdlKyspIHtcbiAgICAgICAgICB2YXIgcmVxdWVzdCA9IGZhY3RvcnkuZ2V0KHVzZXJOYW1lLCB7XG4gICAgICAgICAgICBwZXJfcGFnZSA6IHBhcmFtcy5wZXJfcGFnZSxcbiAgICAgICAgICAgIHBhZ2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXF1ZXN0cy5wdXNoKHJlcXVlc3QpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlcXVlc3RzO1xuXG4gICAgICB9LFxuXG4gICAgICAvLyByZXF1ZXN0IGZvciBhIGdpdGh1YiB1c2VyIHJlcG9zaXRvcnlcbiAgICAgIGdldCA6ICh1c2VyTmFtZSwgcGFyYW1zID0ge1xuICAgICAgICBwYWdlIDogMSxcbiAgICAgICAgcGVyX3BhZ2UgOiA1MFxuICAgICAgfSkgPT4gKG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcblxuICAgICAgICAkbG9nLmRlYnVnKFxuICAgICAgICAgICdnZXQnLFxuICAgICAgICAgIGBVc2VybmFtZSA6ICR7dXNlck5hbWV9YCxcbiAgICAgICAgICBgUGFnZSA6ICR7cGFyYW1zLnBhZ2V9YCxcbiAgICAgICAgICBgUGVyIFBhZ2UgOiAke3BhcmFtcy5wZXJfcGFnZX1gLFxuICAgICAgICAgIHBhcmFtc1xuICAgICAgICApO1xuXG4gICAgICAgIHJldHVybiAkaHR0cCh7XG4gICAgICAgICAgbWV0aG9kIDogJ0dFVCcsXG4gICAgICAgICAgdXJsIDogYGh0dHBzOi8vYXBpLmdpdGh1Yi5jb20vdXNlcnMvJHt1c2VyTmFtZX0vcmVwb3NgLFxuICAgICAgICAgIHBhcmFtc1xuICAgICAgICB9KS50aGVuKChyZXNwb25zZSkgPT4ge1xuXG4gICAgICAgICAgaWYgKCFyZXNwb25zZS5zdGF0dXMpIHtcbiAgICAgICAgICAgIHJldHVybiByZWplY3QocmVzcG9uc2UpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgcmV0dXJuIHJlamVjdChyZXNwb25zZSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIHJlc29sdmUocmVzcG9uc2UpO1xuXG4gICAgICAgIH0sIChlcnJvcikgPT4gcmVqZWN0KGVycm9yKSlcblxuICAgICAgfSkpXG5cbiAgICB9O1xuXG4gICAgcmV0dXJuIGZhY3Rvcnk7XG5cbiAgfSlcbiAgLmNvbnRyb2xsZXIoJ0dpdGh1YlVzZXJSZXBvc2l0b3JpZXNDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJGluamVjdG9yKSB7XG5cbiAgICBjb25zdFxuXG4gICAgICB2bSA9IHRoaXMsXG5cbiAgICAgICRsb2cgPSAkaW5qZWN0b3IuZ2V0KCckbG9nJyksXG5cbiAgICAgIGdpdGh1YlVzZXJSZXBvc2l0b3JpZXMgPSAkaW5qZWN0b3IuZ2V0KCdnaXRodWJVc2VyUmVwb3NpdG9yaWVzRmFjdG9yeScpLFxuXG4gICAgICAvLyBjaGVja3MgY3VycmVudCB1c2VybmFtZSBpcyB2YWxpZCBvciBub3RcbiAgICAgIGlzVXNlcm5hbWVWYWxpZCA9ICgpID0+IHtcblxuICAgICAgICBpZiAoIWFuZ3VsYXIuaXNTdHJpbmcodm0udXNlck5hbWUpKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHZtLnVzZXJOYW1lLmxlbmd0aCA+PSAxO1xuICAgICAgfSxcblxuICAgICAgLy8gcmVzZXRzIGN1cnJlbnQgZXJyb3IgYW5kIGxvYWRlZCByZXBvc2l0b3JpZXNcbiAgICAgIHJlc2V0UmVwb3NpdG9yaWVzID0gKCkgPT4ge1xuICAgICAgICAkbG9nLmRlYnVnKCdyZXNldHRpbmcgcmVwb3NpdG9yaWVzJyk7XG4gICAgICAgIHZtLnJlcG9zaXRvcmllcyA9IFtdO1xuICAgICAgICB2bS5lcnJvciA9ICcnO1xuICAgICAgfSxcblxuICAgICAgLy8gY2hlY2tzIHJlc3BvbnNlIGFuZCBzZXRzIGFuIGVycm9yIGlmIG5lZWRlZFxuICAgICAgY2hlY2tSZXNwb25zZSA9IChyZXNwb25zZSkgPT4ge1xuXG4gICAgICAgIGlmIChhbmd1bGFyLmlzT2JqZWN0KHJlc3BvbnNlKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICB2bS5lcnJvciA9IHZtLnN0ci5ub1Jlc3BvbnNlO1xuICAgICAgICAgICRsb2cuZXJyb3IoJ2NoZWNrUmVzcG9uc2UnLCB2bS5zdHIubm9SZXNwb25zZSwgcmVzcG9uc2UpO1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xuXG4gICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB2bS5lcnJvciA9IHZtLnN0ci5ub1JlcG9zO1xuICAgICAgICAgICAgJGxvZy5kZWJ1ZygnY2hlY2tSZXNwb25zZScsIHZtLnN0ci5ub1JlcG9zLCByZXNwb25zZSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgJGxvZy5kZWJ1ZygnY2hlY2tSZXNwb25zZScsIDIwMCwgcmVzcG9uc2UpO1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDA0KSB7XG4gICAgICAgICAgdm0uZXJyb3IgPSB2bS5zdHIubm9Vc2VyO1xuICAgICAgICAgICRsb2cuZGVidWcoJ2NoZWNrUmVzcG9uc2UnLCB2bS5zdHIubm9Vc2VyLCByZXNwb25zZSk7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgJGxvZy5kZWJ1ZygnY2hlY2tSZXNwb25zZScsIHZtLnN0ci5ub1Jlc3BvbnNlLCByZXNwb25zZSk7XG4gICAgICAgIHZtLmVycm9yID0gdm0uc3RyLm5vUmVzcG9uc2U7XG4gICAgICAgIHJldHVybiBmYWxzZTtcblxuICAgICAgfSxcblxuICAgICAgLy8gZm9ybWF0cyByZXBvc2l0b3JpZXMgZm9yIGxpbmsgbGlzdFxuICAgICAgZm9ybWF0UmVwb3NpdG9yaWVzID0gKHJlcG9zaXRvcmllcykgPT4gcmVwb3NpdG9yaWVzXG4gICAgICAgIC5tYXAoKHJlcG9zaXRvcnkpID0+ICh7XG4gICAgICAgICAgaWQgOiByZXBvc2l0b3J5LmlkLFxuICAgICAgICAgIG5hbWUgOiByZXBvc2l0b3J5Lm5hbWUsXG4gICAgICAgICAgbGluayA6IHJlcG9zaXRvcnkuaHRtbF91cmxcbiAgICAgICAgfSkpLFxuXG4gICAgICAvLyBzZXRzIHJlcG9zaXRvcmllcyBmcm9tIGdpdmVuIHJlc3BvbnNlXG4gICAgICB1cGRhdGVSZXBvc2l0b3JpZXMgPSAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgJGxvZy5kZWJ1ZyhgdXBkYXRlUmVwb3NpdG9yaWVzJHtyZXNwb25zZS5jb25maWcucGFyYW1zLnBhZ2V9YCwgcmVzcG9uc2UpO1xuXG4gICAgICAgIHZtLnJlcG9zaXRvcmllcyA9IHZtLnJlcG9zaXRvcmllc1xuICAgICAgICAgIC5jb25jYXQoZm9ybWF0UmVwb3NpdG9yaWVzKHJlc3BvbnNlLmRhdGEpKTtcblxuICAgICAgICAkc2NvcGUuJGRpZ2VzdCgpO1xuXG4gICAgICAgIHJldHVybiB2bS5yZXBvc2l0b3JpZXM7XG4gICAgICB9LFxuXG4gICAgICAvLyBvbiB1c2VybmFtZSBjaGFuZ2VzLCB0cmlnZ2VycyBmZXRjaGluZyByZXBvc2l0b3JpZXNcbiAgICAgIG9uVXNlck5hbWVDaGFuZ2UgPSAobmV3VmFsLCBvbGRWYWwpID0+IHtcbiAgICAgICAgaWYgKG5ld1ZhbCA9PT0gb2xkVmFsKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHZtXG4gICAgICAgICAgLmdldFJlcG9zaXRvcmllcygpXG4gICAgICAgICAgLnRoZW4oKHJlcG9zaXRvcmllcykgPT4gJGxvZ1xuICAgICAgICAgICAgLmRlYnVnKCdvblVzZXJOYW1lQ2hhbmdlLmdldFJlcG9zaXRvcmllcycsIHJlcG9zaXRvcmllcykpXG4gICAgICAgICAgLmNhdGNoKChyZXBvc2l0b3JpZXMpID0+ICRsb2dcbiAgICAgICAgICAgIC5lcnJvcignb25Vc2VyTmFtZUNoYW5nZS5mYWlsZWRUb0dldFJlcG9zaXRvcmllcycsIHJlcG9zaXRvcmllcykpO1xuICAgICAgfTtcblxuICAgIE9iamVjdC5hc3NpZ24odm0sIHtcblxuICAgICAgLy8gbG9jYWxlIHN0cmluZ3NcbiAgICAgIHN0ciA6IHtcbiAgICAgICAgdGl0bGUgOiAnR2l0aHViIFVzZXIgUmVwb3NpdG9yaWVzJyxcbiAgICAgICAgdXNlck5hbWUgOiAnVXNlcm5hbWUnLFxuICAgICAgICB1c2VybmFtZVBsYWNlaG9sZGVyIDogJ1BsZWFzZSB3cml0ZSBhIEdpdGh1YiB1c2VybmFtZSB0byBzZWFyY2gnLFxuICAgICAgICBpbnZhbGlkVXNlck5hbWUgOiAnVXNlcm5hbWUgaXMgbm90IHZhbGlkJyxcbiAgICAgICAgbm9Vc2VyIDogJ1RoZSBHaXRodWIgdXNlciBkb2VzIG5vdCBleGlzdCcsXG4gICAgICAgIG5vUmVwb3MgOiAnR2l0aHViIHVzZXIgaGFzIG5vIHJlcG9zJyxcbiAgICAgICAgbm9SZXNwb25zZSA6ICdHaXRodWIgQVBJIGRvZXMgbm90IHJlc3BvbmQnXG4gICAgICB9LFxuXG4gICAgICBlcnJvciA6IGZhbHNlLFxuXG4gICAgICB1c2VyTmFtZSA6ICcnLFxuXG4gICAgICByZXBvc2l0b3JpZXMgOiBbXSxcblxuICAgICAgdXNlck5hbWVNb2RlbE9wdGlvbnMgOiB7XG4gICAgICAgIGRlYm91bmNlOiB7XG4gICAgICAgICAgZGVmYXVsdCA6IDI1MCxcbiAgICAgICAgICBibHVyIDogMFxuICAgICAgICB9XG4gICAgICB9LFxuXG4gICAgICAvLyBzdHJpcHMgZW1wdHkgc3BhY2UgZnJvbSB1c2VybmFtZVxuICAgICAgc3RyaXBVc2VyTmFtZSA6IGZ1bmN0aW9uIChldmVudCkge1xuXG4gICAgICAgIGlmICghYW5ndWxhci5pc09iamVjdChldmVudC50YXJnZXQpKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFhbmd1bGFyLmlzU3RyaW5nKGV2ZW50LnRhcmdldC52YWx1ZSkpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LnZhbHVlLmluZGV4T2YoJyAnKSA+PSAwKSB7XG4gICAgICAgICAgdm0udXNlck5hbWUgPSBldmVudC50YXJnZXQudmFsdWUucmVwbGFjZSgvXFxzKy9nLCAnJyk7XG4gICAgICAgIH1cbiAgICAgIH0sXG5cbiAgICAgIC8vIGZldGNoZXMgYWxsIHJlcG9zaXRvcmllcyB0byBjdXJyZW50IGNvbnRleHRcbiAgICAgIGdldFJlcG9zaXRvcmllcyA6ICgpID0+IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcblxuICAgICAgICByZXNldFJlcG9zaXRvcmllcygpO1xuXG4gICAgICAgIGlmIChpc1VzZXJuYW1lVmFsaWQodm0udXNlck5hbWUpID09PSBmYWxzZSkge1xuICAgICAgICAgIHJldHVybiByZXNvbHZlKHZtLnJlcG9zaXRvcmllcyk7XG4gICAgICAgIH1cblxuICAgICAgICBnaXRodWJVc2VyUmVwb3NpdG9yaWVzXG4gICAgICAgICAgLmdldCh2bS51c2VyTmFtZSlcbiAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHtcblxuICAgICAgICAgICAgaWYgKGNoZWNrUmVzcG9uc2UocmVzcG9uc2UpID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICByZXR1cm4gcmVqZWN0KHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHVwZGF0ZVJlcG9zaXRvcmllcyhyZXNwb25zZSkgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgIHJldHVybiByZWplY3QocmVzcG9uc2UpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgc3ViUGFnZXMgPSBnaXRodWJVc2VyUmVwb3NpdG9yaWVzXG4gICAgICAgICAgICAgIC5nZXRBbGwodm0udXNlck5hbWUsIHJlc3BvbnNlKTtcblxuICAgICAgICAgICAgaWYgKCFzdWJQYWdlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUodm0ucmVwb3NpdG9yaWVzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGV0IHN1YlJlcXVlc3RzID0gc3ViUGFnZXMubWFwKChyZXF1ZXN0KSA9PiB7XG4gICAgICAgICAgICAgIHJlcXVlc3RcbiAgICAgICAgICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICAgICAgICRsb2cuZGVidWcoYHN1YlBhZ2Uke3Jlc3BvbnNlLmNvbmZpZy5wYXJhbXMucGFnZX1gLCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICBpZiAoY2hlY2tSZXNwb25zZShyZXNwb25zZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlUmVwb3NpdG9yaWVzKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICAgICRsb2cuZXJyb3IoJ3N1YlBhZ2UnLCBlcnJvcik7XG4gICAgICAgICAgICAgICAgICBjaGVja1Jlc3BvbnNlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwoc3ViUmVxdWVzdHMpO1xuXG4gICAgICAgICAgfSlcbiAgICAgICAgICAuY2F0Y2goKHJlc3BvbnNlKSA9PiB7XG5cbiAgICAgICAgICAgIGNoZWNrUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgICAgICAgICAgJHNjb3BlLiRkaWdlc3QoKTtcblxuICAgICAgICAgICAgcmVqZWN0KHJlc3BvbnNlKTtcblxuICAgICAgICAgIH0pXG4gICAgICAgICAgLnRoZW4oKCkgPT4ge1xuXG4gICAgICAgICAgICByZXNvbHZlKHZtLnJlcG9zaXRvcmllcyk7XG5cbiAgICAgICAgICB9KVxuICAgICAgICAgIC5jYXRjaChyZWplY3QpO1xuXG4gICAgICB9KVxuXG4gICAgfSk7XG5cbiAgICAkc2NvcGUuJHdhdGNoKCgpID0+IHZtLnVzZXJOYW1lLCBvblVzZXJOYW1lQ2hhbmdlKTtcblxuICB9KTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
